.row
  .col-md-9
    ul.nav.nav-tabs
      li.active(role='presentation')
        a(href='#') Tick Forecast
      li(role='presentation')
        a(href='/map') About Tick Observations
      li(role='presentation')
        a(href='https://report.bigelow.org/tick/') Report Ticks  
    #map
    br
    br      
    
  .col-md-3
    br
    br        
    .panel.panel-default
      .panel-heading
        h3.panel-title Forecast Control Panel
      .panel-body
        .row
          .col-md-7
            p Play Forecast:
            br
            .slider
              input(type='range', name='points', min='0', max='10',value='0')#slider 
            br
          .col-md-5
            p Date:
            br
            p#date 07-09-2017
        p Liklihood of Tick Encounter:
        #colorstrip
        .pull-right High
        div Low
                
    br
    br  
    .panel.panel-default
      .panel-heading
        h3.panel-title Other Forecasts
      .panel-body          
        ul.nav.nav-pills.nav-stacked
          li.active(role='presentation')
            a(href='#') Jelly Fish
          li.active(role='presentation')
            a(href='#') Moose
        
 
      


style.
  
  body {
    margin-left: 50px;
    margin-right: 50px;
  }
  
  #map {
    height: 70vh;
    width: 100%;
  }
  
  #colorstrip{
      height: 50px;
      border-style: solid;
      border-color: white;
      background-image: -webkit-linear-gradient(left, blue, green, yellow, red);
      background-image: -moz-linear-gradient(left, blue, green, yellow, red);
      background-image: -o-linear-gradient(left, blue, green, yellow, red);
      background-image: linear-gradient(left, blue, green, yellow, red);
  }
    
script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyBQgilx3e3-f0pgRfx-GCnNgzWllJlMhSs')
script.

  var threedaysago = (3).days().ago().toString("MM-dd-yyyy");
  var twodaysago = (2).days().ago().toString("MM-dd-yyyy");
  var yesterday = (1).days().ago().toString("MM-dd-yyyy");
  var today = new Date.today().toString("MM-dd-yyyy");
  var tomorrow = new Date.today().addDays(1).toString("MM-dd-yyyy");
  var twodaysfromnow = new Date.today().addDays(2).toString("MM-dd-yyyy");
  var threedaysfromnow = new Date.today().addDays(3).toString("MM-dd-yyyy");
  

  // animate forcast
  var overlay;
  var map;
  forcastOverlay.prototype = new google.maps.OverlayView();
  
  function initMap() {
    
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 7,
      center: {lat: 44.8012, lng: -68.7778},
    });
    
    var bounds = new google.maps.LatLngBounds(
      new google.maps.LatLng(40.9470950033508, -73.9987308620128),
      new google.maps.LatLng(48.1221341816001, -59.6983306401886));
      
      var srcImage = "https://static.bigelow.org/data/ecocast/tick/"+today+".png";
      document.getElementById("date").innerHTML = today;
      overlay = new forcastOverlay(srcImage,bounds);
      

    }
    
    
    
    /** @constructor */
    function forcastOverlay( image,bounds) {
      // Now initialize all properties.
      this.bounds_ = bounds;
      this.image_ = image;
      this.div_ = null;
      this.setMap(map);
    }
    
    /**
    * onAdd is called when the map's panes are ready and the overlay has been
    * added to the map.
    */
    forcastOverlay.prototype.onAdd = function() {
      var div = document.createElement('div');
      div.style.border = 'none';
      div.style.borderWidth = '0px';
      div.style.position = 'absolute';
      // Create the img element and attach it to the div.
      var img = document.createElement('img');
      img.src = this.image_;
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.opacity = 0.5;
      div.appendChild(img);
      this.div_ = div;
      // Add the element to the "overlayImage" pane.
      var panes = this.getPanes();
      panes.overlayImage.appendChild(this.div_);
    };
    
    
    forcastOverlay.prototype.draw = function() {
      // We use the south-west and north-east
      // coordinates of the overlay to peg it to the correct position and size.
      // To do this, we need to retrieve the projection from the overlay.
      var overlayProjection = this.getProjection();
      // Retrieve the south-west and north-east coordinates of this overlay
      // in LatLngs and convert them to pixel coordinates.
      // We'll use these coordinates to resize the div.
      var sw = overlayProjection.fromLatLngToDivPixel(this.bounds_.getSouthWest());
      var ne = overlayProjection.fromLatLngToDivPixel(this.bounds_.getNorthEast());
      // Resize the image's div to fit the indicated dimensions.
      var div = this.div_;
      div.style.left = sw.x + 'px';
      div.style.top = ne.y + 'px';
      div.style.width = (ne.x - sw.x) + 'px';
      div.style.height = (sw.y - ne.y) + 'px';
    };
    
  
    forcastOverlay.prototype.changeImage = function(new_url) {
      this.div_.getElementsByTagName('img')[0].src= new_url;
    };

  google.maps.event.addDomListener(window, 'load', initMap);



script(type="text/javascript").
  $('#slider').mousemove(function() {
    var theValue = $('#slider').val();

    if (theValue == 2){
  
      overlay.changeImage("https://static.bigelow.org/data/ecocast/tick/"+threedaysago+".png");
      document.getElementById("date").innerHTML = threedaysago;
  
    } else if (theValue ==4){
  
     overlay.changeImage("https://static.bigelow.org/data/ecocast/tick/"+twodaysago+".png"); 
     document.getElementById("date").innerHTML = twodaysago;
      
  
    } else if(theValue == 6){
  
       overlay.changeImage("https://static.bigelow.org/data/ecocast/tick/"+yesterday+".png");
       document.getElementById("date").innerHTML = yesterday;       
    } else if (theValue == 9){
  
       overlay.changeImage("https://static.bigelow.org/data/ecocast/tick/"+today+".png");
       document.getElementById("date").innerHTML = today;      
    }

  });
